<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Demo</title>
		<link rel="stylesheet" href="demo.css" />
	</head>
	<body>
			<ul id="ul">
				<li class="liBox">
					<div>
						<div class="lid011" id="checkAll" ><h5>全选</h5></div>
					</div>	
					<button type="button" class="sort" >升序</button>
					<button type="button" class="sort1" >降序</button>
					<input type="button" value="全部删除"  class="del"/>
					<input type="search" id="search" placeholder="请输入需要查找的数据编号!" /><button type="button" class="search" >搜索</button>					
				</li>
				<li class="liBox11">
					<div class="checkbox">
						<input type="checkbox" name="chebox" id="checkbox001">
					</div>
					<div class="lid111"><h5>时间</h5></div>
					<div class="lid010"><h5>编号</h5></div>
					<div class="lid010"><h5>姓名</h5></div>
					<div class="lid010"><h5>密码</h5></div>
					<div class="lid010"><h5>生日</h5></div>
					<div class="lid010"><h5>地址</h5></div>
					<div class="lid00000"><h5>操作</h5></div>
				</li>
			</ul>
		<form action="">
		<!--第二张表-->	
			<ul id=ul1>
					<div class="title1">
						<h2>新增数据</h2>
					</div>
				<li class="liBox0000">
					<div class="lid0"><h5>编号</h5></div>
					<div class="lid01">
						<input id="d1" type="text" placeholder="请输入您的数据编号"/>&nbsp<span id='prompt'>*</span>
					</div>
					
				</li>
				<li class="liBox0000">
					<div class="lid0"><h5>姓名</h5></div>
					<div class="lid01">
						<input  id="d2" type="text" placeholder="请输入您的姓名"/>&nbsp<span id='prompt1'>*</span>
					</div>
				</li>
				<li class="liBox0000">
					<div class="lid0"><h5>密码</h5></div>
					<div class="lid01">
						<input  id="d3" type="password" placeholder="请输入您的密码"/>&nbsp<span id='prompt2'>*</span>
					</div>
				</li>
				<li class="liBox0000">
					<div class="lid0"><h5>生日</h5></div>
					<div class="lid01">
						<input id="d4" type="text" placeholder="请输入您的出生日期"/>&nbsp<span id='prompt3'>*</span>
					</div>
				</li>
				<li class="liBox0000">
					<div class="lid0"><h5>地址</h5></div>
					<div class="lid01">
						<input  id="d5" type="text" placeholder="请输入您的详细地址"/>&nbsp<span id='prompt4'>*</span>
					</div>
				</li>
				<li class="liBox0001">	
					<button type="reset" value="Reset" class="del3">重置</button>
					<button type="button" class="del4">添加</button>
					<button type="button" class="del5" onclick="update(this)">更新</button>
				</li>
			</ul>
		</form>
	</body>
	<script type="">			
			var userArr = [];//创建一个空数组，用来保存添加的数据，localStorage					
			//为删除按钮添加监听事件
			var del_btn=document.getElementsByClassName('del');
			del_btn[0].addEventListener("click", delall);
			
			/*全部删除按钮*/
			function delall(){			
				var ul = document.getElementById("ul");//整个表
				var chebox=document.getElementsByName("chebox");//复选框
				//console.log(chebox);
				/*遍历所有复选框*/
				for(var i=1;i<chebox.length;i++){
					if(chebox[i].checked){//如果被选中
						var cheboxs = chebox[i].parentNode.parentNode;//获取被选中复选框的li
						ul.removeChild(cheboxs);//移除ul下被选中复选框的单元格
						i--;//全选删除
					}
				}
				
				/*清空新增数据文本框*/
				document.getElementById("d1").value="";
				document.getElementById("d2").value="";
				document.getElementById("d3").value="";
				document.getElementById("d4").value="";
				document.getElementById("d5").value="";
				/*初始化复选框状态*/
				/*？？？？？？？？？？？？？？？？？？*/
			}


			/*复选框功能*/
			/*全选*/
			var checkAll = document.getElementById("checkbox001");
				checkAll.addEventListener("click", ckAll);
			function ckAll(){
				var checkAll=document.getElementById("checkbox001").checked;
				var checks=document.getElementsByName("chebox");
				for(var i=0;i<checks.length;i++){
					checks[i].checked=checkAll;
				}
			}
			
			/*单元格删除按钮*/
			function removeElement(e){				
				var ul = document.getElementById("ul");//获取整个动态添加li的ul
				ul.removeChild(e.parentNode.parentNode);//移除当前按钮父元素的父元素
			}	
			
			/*添加按钮事件*/
				var btn = document.getElementsByClassName("del4");//获取添加按钮
				btn[0].addEventListener("click", addElement);//为添加按钮增加监听事件
			

			/*添加按钮*/
			function addElement(e){
				/*获取input内容*/
				var add=document.getElementById("d1").value;
				var add1=document.getElementById("d2").value;
				var add2=document.getElementById("d3").value;
				var add3=document.getElementById("d4").value;
				var add4=document.getElementById("d5").value;
				/*获取时间*/
				var nowDate = new Date().toLocaleString(); //日期格式出错，待修改
				//nowDate = nowDate.replace(" ","-");//title属性不识别空格，替换时间戳空格为-
				
				/*如果输入为空，禁用添加按钮*/
				if(add==''||add1==''||add2==''||add3==''||add4==''){
					//禁用添加按钮
					console.log("请填写完整信息");
				}else{
					/*动态创建li添加到ul*/
			　　　　var ul = document.getElementById("ul");//创建一个li
			　　　　var li = document.createElement("LI");	
			　　　　li.setAttribute("class", "liBox11");//设置 li 属性				
					li.innerHTML = "<div class='checkbox'><input type='checkbox' name='chebox'></div><div class='lid11' title="+nowDate+">"+nowDate+"</div><div class='lid00' title="+add+">"+add+"</div><div class='lid00' title="+add1+">"+add1+"</div><div class='lid00' title="+add2+">"+add2+"</div><div class='lid00' title="+add3+">"+add3+"</div><div class='lid000' title="+add4+">"+add4+"</div><div class='lid0000'><button class='del0' id='ddd' onclick='removeElement(this)'>删除</button></div><div ><button class='del1'onclick='modify(this)'>修改</button></div>"
			　　　   ul.appendChild(li);
			/*添加数据时，移除暂无数据*/
				var lis=document.getElementsByClassName('liBox_1');//获取动态添加li
					if(lis.length==0){//判断动态添加li是否存在
						/*无操作*/
					}else{
						var ul = document.getElementById("ul");//获取ul
				　　　　var li = document.getElementsByClassName('liBox_1');
							ul.removeChild(li[0]);	//移除ul下，下标为0的li，暂无数据单元格
					}
					/*添加之后清空input值*/
					document.getElementById("d1").value="";
					document.getElementById("d2").value="";
					document.getElementById("d3").value="";
					document.getElementById("d4").value="";
					document.getElementById("d5").value="";	
					
					
					/*添加数据内容存储在localStorage*/
					userArr.push([nowDate,add,add1,add2,add3,add4]);//将获取的iniput的值存入一个二维数组中
					localStorage.setItem('userArr',JSON.stringify(userArr));//转为字符串形式存入localStorage中
					
					
					/*创建一个新数组，保存时间数据*/
					var time=document.getElementsByClassName('lid11');
					var ArrAy=[];//创建一个新数组
					for(var i=0;i<time.length;i++){//遍历所有时间栏单元格
						a=time[i].innerHTML;//获取时间单元格内的时间
						/*转为毫秒数*/
						var F= a.substring(0, 10);//截取去除中文的时间字段
						var	f= a.substring(12,a.length);//截取去除中文的时间字段
						var Time=F+f;//将时间拼接
						var T = new Date(Time);//转换为标准时间
						var M =T.getTime();//当前时间的毫秒数
						ArrAy.push(M);//添加入新数组
						//console.log(ArrAy);
					}
				}
　　			}	


			/*排序按钮*/
			/*升序*/
			//事件监听
			var Ascending_btn=document.getElementsByClassName('sort');//获取升序按钮
			Ascending_btn[0].addEventListener("click",Ascending);
			//排序方法
			function sortArr(m,n){ 
				return m-n; 
			}

			function Ascending(){
				var userArr = localStorage.getItem('userArr');//取出localstorage的数据
						userArr = JSON.parse(userArr);
						var Array=[];
						//遍历此数组	
					for(var i=0;i<userArr.length;i++){
						var a=userArr[i][0];
						var F= a.substring(0, 10);//截取去除中文的时间字段					
						var	f= a.substring(12,a.length);//截取去除中文的时间字段
						var Time=F+f;//将时间拼接
						var T = new Date(Time);//转换为标准时间
						var M =T.getTime();//当前时间的毫秒数
						Array.push(M);					
						Array.sort(sortArr);//降序排列数组				
					}
						//console.log(Array);//排序好的数组
						//console.log(userArr);
						
						//清空现有li单元格的排序
						var lis= document.getElementsByClassName('liBox11');//获取整行li
						var UL=document.getElementById('ul');//获取ul
						//console.log(lis);
							for(var i=1;i<lis.length;i++){
								if(i==0){
									return;//i==0时跳出方法，不再执行
								}else{
									UL.removeChild(lis[i]);//移除li
									i--;//全部移除
								}				
							}
						//重排单元格
						for(var i=0;i<userArr.length;i++){
							var ul = document.getElementById("ul");//获取ul
					　　　　 var li = document.createElement("LI");//创建一个li
					　　　　li.setAttribute("class", "liBox11");//设置 li 属性				
							li.innerHTML = "<div class='checkbox'><input type='checkbox' name='chebox'></div><div class='lid11' title='时间'>"+userArr[i][0]+"</div><div class='lid00' title="+userArr[i][1]+">"+userArr[i][1]+"</div><div class='lid00' title="+userArr[i][2]+">"+userArr[i][2]+"</div><div class='lid00' title="+userArr[i][3]+">"+userArr[i][3]+"</div><div class='lid00' title="+userArr[i][4]+">"+userArr[i][4]+"</div><div class='lid000' title="+userArr[i][5]+">"+userArr[i][5]+"</div><div class='lid0000'><button class='del0' id='ddd' onclick='removeElement(this)'>删除</button></div><div ><button class='del1'onclick='modify(this)'>修改</button></div>"
							ul.appendChild(li);
						}								
			}
					
			
			
			/*降序*/
			//事件监听
			var Descending_btn=document.getElementsByClassName('sort1');//获取降序按钮
			Descending_btn[0].addEventListener("click",Descending);
			//排序方法
			function sortArr(m,n){
				return m-n; 
			}
	
			function Descending(){
						var userArr = localStorage.getItem('userArr');//取出localstorage的数据
						userArr = JSON.parse(userArr);
						var Array=[];
						//遍历此数组	
					for(var i=0;i<userArr.length;i++){
						var a=userArr[i][0];
						var F= a.substring(0, 10);//截取去除中文的时间字段					
						var	f= a.substring(12,a.length);//截取去除中文的时间字段
						var Time=F+f;//将时间拼接
						var T = new Date(Time);//转换为标准时间
						var M =T.getTime();//当前时间的毫秒数
						Array.push(M);					
						Array.sort(sortArr).reverse();//降序排列数组				
					}
						//console.log(Array);//排序好的数组
						//console.log(userArr);
						userArr.sort(sortArr).reverse();
						
						//console.log(userArr[0][0]);
						//console.log(userArr);
						//清空现有li排序
						var lis= document.getElementsByClassName('liBox11');//获取li
						var UL=document.getElementById('ul');//获取ul
						//console.log(lis);
							for(var i=1;i<lis.length;i++){
								if(i==0){
									return;//i==0时跳出方法，不再执行
								}else{
									UL.removeChild(lis[i]);//移除li
									i--;//全部移除
								}
							
							}
						//重排单元格
						for(var i=0;i<userArr.length;i++){
						var ul = document.getElementById("ul");//获取ul
				　　　　 var li = document.createElement("LI");//创建一个li
				　　　　li.setAttribute("class", "liBox11");//设置 li 属性				
						li.innerHTML = "<div class='checkbox'><input type='checkbox' name='chebox'></div><div class='lid11' title='时间'>"+userArr[i][0]+"</div><div class='lid00' title="+userArr[i][1]+">"+userArr[i][1]+"</div><div class='lid00' title="+userArr[i][2]+">"+userArr[i][2]+"</div><div class='lid00' title="+userArr[i][3]+">"+userArr[i][3]+"</div><div class='lid00' title="+userArr[i][4]+">"+userArr[i][4]+"</div><div class='lid000' title="+userArr[i][5]+">"+userArr[i][5]+"</div><div class='lid0000'><button class='del0' id='ddd' onclick='removeElement(this)'>删除</button></div><div ><button class='del1'onclick='modify(this)'>修改</button></div>"
						ul.appendChild(li);
					}
 				}
				
				
				
			/*搜索框----根据编号查找localStorage存储的编号数据*/
			var timer = 0;
			var search_input = document.getElementById('search');//获取搜索框
			search_input.addEventListener('keyup',function(e){//增加一个监听事件（键盘抬起事件）
				var value = search_input.value;//获取搜索框中的内容
				timer = setTimeout(function(){//设置一个定时器
					clearTimeout(timer);//清空定时器
					var search_result = [];//创建一个新数组
					var userArr = localStorage.getItem('userArr');//将存储在localStorage中的字符串类型数值取出
					userArr = JSON.parse(userArr);//转为JSON对象（一个二维数组）
					//console.log(userArr)//打印全部localStorage对象
					for(var i = 0;i<userArr.length;i++){//遍历这个二维数组
						if(userArr[i][0].indexOf(value.trim()) != -1){//如果在这个数组的编号部分，检索字符串值出现（获取的搜索框中的内容去除空格（trim()）！=-1）
							console.log(userArr[i][1]);//编号
							search_result.push(userArr[i]);//就将此条数据push入新数组
						}
					}
					console.log((search_result));//将数组数据打印在控制台上
				},100)
			})
			
			/*搜索按钮*/
				/*事件监听*/
				var search_btn=document.getElementsByClassName("search");
				var search_input = document.getElementById('search');
				search_btn[0].addEventListener("click",searchbtn);//添加监听事件
				/*防止重复搜索同一数据？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？*/
						
				/*按钮功能*/
				function searchbtn(){
						var value = search_input.value;
						var search_result = [];//创建一个新数组
						var userArr = localStorage.getItem('userArr');//将存储在localStorage中的字符串类型数值取出
						userArr = JSON.parse(userArr);//转为JSON对象（一个二维数组）
						if(!userArr){
							console.log("无数据");
							return//跳出步骤执行，中断方法
						}
		
						//清空现有单元格排序
						var lis= document.getElementsByClassName('liBox11');//获取li
						var UL=document.getElementById('ul');//获取ul
						//console.log(lis);
							for(var i=1;i<lis.length;i++){
								if(i==0){
									return;//i==0时跳出方法，不再执行
								}else{
									UL.removeChild(lis[i]);//移除li
									i--;//全部移除
								}
							
							}

						//console.log(userArr)//打印全部localStorage对象
						for(var i = 0;i<userArr.length;i++){//遍历这个二维数组
							if(userArr[i][1].indexOf(value.trim()) != -1){//如果在这个数组的编号部分，检索字符串值出现（获取的搜索框中的内容去除空格（trim()）！=-1）
								search_result.push(userArr[i]);//就将此条数据push入新数组
								//console.log(search_result[i][1]);//数据编号
							}
						}
								//console.log(search_result[0][1]);			
						for(var i=0;i<search_result.length;i++){//遍历新数组
							if(search_result[i][1].indexOf(value.trim()) != -1){//如果在这个数组的编号部分，检索字符串值出现（获取的搜索框中的内容去除空格（trim()）！=-1）
							var list = document.getElementById("ul");//获取ul
							var li = document.createElement("LI");//新建li
							li.setAttribute("class", "liBox1");//设置li
							li.innerHTML ="<div class='checkbox'><input type='checkbox' name='chebox' ></div><div class='lid11' title='search_result[i][0]'>"+search_result[i][0]+"</div><div class='lid00' title='search_result[i][1]'>"+search_result[i][1]+"</div><div class='lid00' title='search_result[i][2]'>"+search_result[i][2]+"</div><div class='lid00' title='search_result[i][3]'>"+search_result[i][3]+"</div><div class='lid300' title='search_result[i][4]'>"+search_result[i][4]+"</div><div class='lid200' title='search_result[i][5]'>"+search_result[i][5]+"</div><div class='lid0000' ><button style='background-color:#B0C4DE;' class='del0' id='ddd' onclick='#' disabled='disabled' >删除</button></div><div ><button class='del1'onclick='#' disabled='disabled' style='background-color:#B0C4DE;'>修改</button></div>"						
							list.appendChild(li);//将搜索结果插入表头
							
							}else{
								return;//如果在这个数组的编号部分，检索字符串值不出现，则返回循环;
							}
						}
						//清空搜索框
						document.getElementById('search').value="";					
				}
				
					
					
					
			/*修改按钮*/
			function modify(e){
				var d1=document.getElementById("d1");
				var d2=document.getElementById("d2");
				var d3=document.getElementById("d3");
				var d4=document.getElementById("d4");
				var d5=document.getElementById("d5");				
				d1.value = e.parentNode.parentNode.children[2].innerHTML;
				d2.value = e.parentNode.parentNode.children[3].innerHTML;
				d3.value = e.parentNode.parentNode.children[4].innerHTML;
				d4.value = e.parentNode.parentNode.children[5].innerHTML;
				d5.value = e.parentNode.parentNode.children[6].innerHTML;
				/*获取点击记录行*/
				that = e.parentNode.parentNode;
				/*移除添加按钮的监听事件*/
				var btn = document.getElementsByClassName("del4");//获取添加按钮
				btn[0].removeEventListener("click", addElement);//移除按钮监听事件
			}
			
			/*更新按钮*/
			function update(e){
				/*重新获取修改后input内容*/
				var add=document.getElementById("d1").value;
				var add1=document.getElementById("d2").value;
				var add2=document.getElementById("d3").value;
				var add3=document.getElementById("d4").value;
				var add4=document.getElementById("d5").value;
				/*获取时间*/
				var nowDate = new Date().toLocaleString();
				console.log(nowDate);
				/*数据更新到原有的li上替换原来的数据*/	
				that.children[1].innerHTML =nowDate;//记录行的时间更新
				that.children[2].innerHTML =add;//记录行的第二个子元素内容修改
				that.children[3].innerHTML =add1;//记录行的第三个子元素内容修改
				that.children[4].innerHTML =add2;//记录行的第四个子元素内容修改
				that.children[5].innerHTML =add3;//记录行的第五个子元素内容修改
				that.children[6].innerHTML =add4;//记录行的第六个子元素内容修改
				/*更新之后清空input值*/
//				document.getElementById("d1").value="";
//				document.getElementById("d2").value="";
//				document.getElementById("d3").value="";
//				document.getElementById("d4").value="";
//				document.getElementById("d5").value="";
			}
				
				
				
				/*加载localStorage存储的值,页面刷新加载时，localStorage如果有值，取出渲染至页面，如果无值显示暂无数据*/
				/*遍历key数组userArr*/
				
				window.onload=function(){					
					var userArr = localStorage.getItem('userArr');
						userArr = JSON.parse(userArr);
					if(!userArr){
							var ul = document.getElementById("ul");//获取ul
							var li = document.createElement("LI");
							li.setAttribute("class", "liBox_1");
							li.innerHTML = "<div><h3>暂无数据!<h3></div>";
							ul.appendChild(li);	//添加暂无数据 
							return//跳出步骤执行，中断方法
						}
					for(var i=0;i<userArr.length;i++){
						var a=userArr[i];
						//console.log(a);
						var ul = document.getElementById("ul");
						var li = document.getElementsByClassName('liBox_1');
						var ul = document.getElementById("ul");//获取ul
							
				　　　　 var li = document.createElement("LI");//创建一个li
				　　　　li.setAttribute("class", "liBox11");//设置 li 属性				
						li.innerHTML = "<div class='checkbox'><input type='checkbox' name='chebox'></div><div class='lid11' title='时间'>"+userArr[i][0]+"</div><div class='lid00' title="+userArr[i][1]+">"+userArr[i][1]+"</div><div class='lid00' title="+userArr[i][2]+">"+userArr[i][2]+"</div><div class='lid00' title="+userArr[i][3]+">"+userArr[i][3]+"</div><div class='lid00' title="+userArr[i][4]+">"+userArr[i][4]+"</div><div class='lid000' title="+userArr[i][5]+">"+userArr[i][5]+"</div><div class='lid0000'><button class='del0' id='ddd' onclick='removeElement(this)'>删除</button></div><div ><button class='del1'onclick='modify(this)'>修改</button></div>"
						ul.appendChild(li);
					}
 				}
	</script>
</html>
